# [個人メモ] ORACLE MASTER Silver Oracle Database 12c 傾向と対策（前編）

# 目次

* 資格概要
* 傾向と対策
* 受験準備にあたって

# 資格概要

* 2017年8月16日に改訂
* 試験対応の製品バージョンは 12.1.0.1.0 のまま
* Install & Upgrade 分野からの出題は大幅削減
* パフォーマンス問題の出題も大幅削減
* DBaas が追加。ただし出題数はわずか
* 重箱の隅を突く問題は削減
* **データベース管理に絞って重点的に勉強することをお薦め**




# 傾向と対策

## 試験内容について

### 試験内容チェックリストから除外されたトピック

* Oracle DB のアーキテクチャ確認
  * 論理ストレージと物理ストレージ構造の関係
* 領域の管理
  * 表領域の領域使用率を予防的に監視および管理
  * 再開可能領域割当を管理する
* Oracle DB 監査の実装
  * セキュリティと監査に関するDBAの職責
* DB メンテナンスの実行
  * AWR を管理
  * ADDM を使用
  * アドバイザフレームワークについて説明し使用する
  * アラートしきい値を設定する
  * 自動化タスクを使用する
* パフォーマンス管理
  * EM を使用してパフォーマンス監視
  * 自動メモリー管理
  * メモリーアドバイザ
* パフォーマンス管理: SQLチューニング
  * オプティマイザ統計管理
  * SQLアクセスアドバイザ
* DBリソースマネージャの使用によるリソースの管理
  * リソースマネージャは出題される
  * ただしスケジューラは出る！
* インストール
* Orale Grid Infrastructure のインストール
* OracleDBソフトウェアのインストール
* DBCAを使用して DB 作詞絵する
* Oracle Restart の使用
* DBのアップグレード
* 12cアップグレードへの準備
* 12cへのアップグレード
  * DBUA を使用して12cにアップグレード
  * スクリプトとツールを使用して12cにアップグレード
* アップグレード後作業
  * 統合監査に移行する
  * アップグレード後の作業を実行する
* Data Pump を使用したデータの移行
  * あくまでアップグレードの際の！

### 追加されたトピック

* DBaaSの概要
  * DBaaSのインスタンス
  * マイ・サービス・ダッシュボードからのナビゲート
  * ユーザー認証とロール
  * 接続プロトコルとポート

### 改訂後の傾向

* DB管理に特化
  * 自動メンテナンス、リソース・マネージャ、ソフトウェアのインストール、Grid Infrastructure、ASMが除外
* インストール・アップグレードは以下のトピックを押さえる
  * DBCA を使用して Oracle Database を作成する
    * DBCA を使用してDB作成スクリプトを生成する
    * DBCA を使用してDB設計テンプレートを管理する
  * Oracle DB ソフトウェアのインストール
    * データ移行方法について説明する
    * アップグレードプロセスについて説明する

例題は少しいやらしい問題になってる！
本番はもっと王道な問題があるYO！

## 各トピックのお話

### アーキテクチャの確認/管理ツール

* 各BGプロセスの役割
* サーバープロセスの役割
  * fg プロセスとも呼ばれる
* メモリ構造
* 共有サーバー構成でのメモリ構造
  * 昔からよく出る(専用サーバーとの違い)
* チェックポイント発生タイミング
  * インスタンスリカバリとの仕組みとの関係含めて
* Oracle Enterprise Manager Express
  * 11g よりも機能が制限された代わりに軽い
  * 起動停止が伴う作業が出来なかったり
  * インスタンスオープン前提

#### 例題1

##### 問題

物理 I/O 操作を削減する目的で KEEPバッシュキャッファを設定しました。
KEEP バッファキャッシュを使用するように設定すべきオブジェクトはどれですか。

1. 一度しかアクセスされない大きな表
2. 頻繁にアクセスされる小さい参照表
3. データ・ディクショナリ
4. 大きなサイズのパッケージ

##### 解答(予想は2)
2

##### 補足

* データ・ディクショナリは共有プールの中のディクショナリキャッシュ
* 大きなサイズのパッケージも共有プール
* オブジェクトの STORAGE 句の BUFFER_POOL で指定

### インスタンス

* 初期化パラメータファイル
  * SPFILE、PFILE
* パラメータ変更
  * 動的パラメータ、静的パラメータ
* 制限モード
* DDLロギング
* アラートログファイル
  * 何が出力されるか
  * どこに出力されるか
* インスタンスの起動
* インスタンスの停止モード
  * normal、transactional など

#### 例題2

##### 問題

PFILEを使用してインスタンスを起動した。

```
memory_max_target 0
memory_target     0
sga_max_size      2G
sga_target        2G
```

`SQL> ALTER SYSTEM SET SHARED_POOL_SIZE=8192M;`

##### 解答(予想は4)
4

##### 補足(PFILE と SPFILE)

* PFILE
  * 8i 以前のプレーンテキストタイプの初期化パラメータファイル
  * 下位互換で12cでも使用可能だが、使用するメリットはない
  * 動的パラメータについて ALTER SYSTEM コマンドによるパラメータ変更は可能だが、現行のインスタンスのみに反映され、PFILE には反映されない
* SPFILE
  * 9i 移行のバイナリタイプの初期化パラメータファイル
  * `ALTER SYSTEM SET parameter_name=value SCOPE={BOTH, MEMORY, SPFILE}`
    * 省略すると `BOTH` が適用
  * 自動メモリ管理での自動調整した値をインスタンス再起動後も維持する
  * `CREATE SPFILE FROM {PFILE, MEMORY}``

#### 例題3
##### 問題

複数のユーザーが接続しているインスタンスで次のコマンドを発行しました。

`ALTER SYSTEM ENABLE RESTRICTED SESSION;`

どのようになりますか。

1. RESTRICTED SESSION 権限を持っていないユーザーのセッションはすべて切断される
2. RESTRICTED SESSION 権限を持っていないユーザーのセッションから発行した SQL はすべて待機となる
3. RESTRICTED SESSION 権限を持っているユーザーは新規にセッションを張ることができる
4. 複数のユーザーが接続しているインスタンスを制限モードの切り替えることはできない

##### 解答(予想 3)
3

##### 補足(制限モード)

* エクスポート、インポート、移行を行う際、一般のユーザーの新規接続を制限するために使用する
* `ALTER SYSTEM ENABLE RESTRICTED SESSION` コマンドで実行中のインスタンスを制限モードに切り替え可能
  * すでに接続中なら影響なし


#### 例題4
##### 問題

DDL ロギングについて正しい説明はどれですか。

1. ENABLE_DDL_LOGGING パラメータを TRUE に設定すると、発行されたすべての DDL がアラート・ログ・ファイルに記録される
2. ENABLE_DDL_LOGGING パラメータを TRUE に設定すると、ロギング対象の DDL が自動診断リポジトリの DDL ログに記録される
3. DDL ログは1つだけ存在し、形式は XML ファイルである
4. ENABLE_DDL_LOGGIN パラメータのデフォルト値は TRUE である

##### 解答(予想 2)
2

##### 補足(DDL ロギング)

* ENABLE_DDL_LOGGING パラメータを TRUE に設定して有効化
* 自動診断リポジトリ(ADR)
  * XML、テキスト両方
* ロギング対象は所定の DDL コマンド

### ネットワーク環境の設定

* リスナー
  * 挙動
  * LSNRCTL コマンド
* 接続開始時の仕組み
* ネーミングメソッド
  * 簡易、ローカル、ディレクトリ
* 共有サーバー構成
  * `SERVER=[DEDICATED | SHARED]`
* プライベート・データベース・リンク
  * `CREATE DATABASE LINK` コマンド


#### 例題5
##### 問題

HR というスキーマが TOKYO, OSAKA という２つの DB に存在しており、パスワードも同じものを設定しています。HR ユーザーは両方の DB に対して CREATE DATABASE LINK 権限及び CREATE SESSION 権限があります。また TOKYOのホスト上の tnsnames.ora ファイルでは、OSAKAへの接続情報を含む OSAKA というネットサービス名を定義しています。

HR ユーザーで TOKYO に接続し、次のコマンドを発行しました。
`CREATE DATABASE LINK osaka USING 'OSAKA';`

どのようになりますか。

1. `CREATE DATABASE LINK` コマンドで CONNECT TO 句を省略しているので、データベース・リンクの作成に失敗する
2. HR ユーザーで TOKYO に接続し、`SELECT * FROM HR.EMP@osaka` を実行すると、データが返される
3. HR ユーザーで TOKYO に接続し、`SELECT * FROM HR.EMP@osaka` を実行すると、HR ユーザーでのパスワードの入力が求められる
4. パブリックデータベース・リンクとして作成される


##### 解答(予想 2)


##### 補足(データベース・リンク)

```SQL
CREATE DATABASE LINK link_name
  [CONNECT TO user_name IDENTIFIED BY password]
  USING connect_string
```

### ユーザー・セキュリティの管理

* ユーザーの作成
  * `CREATE USER` コマンド
  * デフォルト値
  * 表領域クォータ
* SYSDBA 権限
* オブジェクト権限の付与と剥奪
* ロール
* プロファイル
  * DEFAULT プロファイル

#### 例題6
##### 問題

SYSDBA システム権限が付与されたユーザー oe が次のコマンドを発行しました

```sql
CONNECT oe
CREATE TABLE test(name VARCHAR2(20));
INSERT INTO test VALUES('TEST')
COMMIT;
```

その後、ユーザー oe が

```sql
CONNECT oe AS SYSDBA
SELECT * FROM test;
```

を実行したらどうなりますか

1. SELECT に成功する
2. ORA-00942: table or view does not exists というエラーが返される

##### 解答(予想 2)
2

##### 補足(SYSDBA システム権限)

* SYSDBA 権限で接続すると SYS スキーマで接続
* SYSOPER 権限で接続すると PUBLIC スキーマで接続

#### 例題7
##### 問題

ユーザーやロールについて正しい説明はどれですか。

1. すべてのロールの所有者は SYS である
2. ユーザーが自分のパスワードを変更するには、ALTER USER システム権限が付与されている必要がある
3. 任意のロールの変更するための条件は、ALTER ANY ROLE システム権限を付与されていることである
4. 事前定義の RESOURCE ロールは、デフォルトで UNLIMITED TABLESPACE システム権限を付与する
5. ユーザーが問い合わせでソート処理を行うには、一時表領域についてもクォータが割当られている必要がある


##### 解答(予想 3)
3

##### 補足

* 非スキーマオブジェクト
  * ロールはシステムオブジェクト(スキーマオブジェクトではない)
* 事前定義ロール
  * RESOURCE ロール
    * 12c 以降は UNLIMITED TABLESPACE システム権限を含まない
  * CONNECT ロール
    * 10g Release 2 以降は CREATE SESSION 権限のみを含む


## 受験準備にあたって
